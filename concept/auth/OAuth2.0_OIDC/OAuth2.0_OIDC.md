# OAuth2.0 & OIDC

## Author
- **KyungTaek Lim (Jonas Lim)**
- Software Engineer
- **Email:** kyungtaekjonaslim@gmail.com
- **LinkedIn:** [KyungTaek Jonas Lim](https://www.linkedin.com/in/kyungtaek-jonas-lim)
- **GitHub:** [kyungtaek-jonas-lim](https://github.com/kyungtaek-jonas-lim)

---
## ODIC(OpenID Connect) with OAuth 2.0 Protocol
- OAuth 2.0
	- Obtain an Access Token and use it to call APIs
		- Access Token is used to access protected resources or perform specific actions on behalf of the user.
	- Focus on Authorization
		- OAuth 2.0 delegates permissions, allowing services to act on the user's behalf without exposing the user's credentials.
	- Comparable to granting an AWS IAM Role to a backend server to perform API calls on behalf of the user.
	
- ODIC
	- Builds on OAuth 2.0
		- Uses OAuth 2.0 to obtain an Access Token and an ID Token.
	- Use the Access Token to call the UserInfo endpoint (optional)
		- The Access Token can be used to fetch additional user details through the UserInfo API.
	- Authenticate the user using the ID Token
		- The ID Token, a JWT signed by the Authorization Server, contains claims that provide information about the authenticated user.
		- ID Tokens are typically signed using the RS256 algorithm.
	- Focus on Authentication
		- OIDC extends OAuth 2.0 to provide identity information, enabling authentication alongside authorization.

- Process
	![OAuth2.0 and OIDC Diagram](https://raw.githubusercontent.com/kyungtaek-jonas-lim/jonastudy/main/concept/auth/OAuth2.0_OIDC/OAuth2.0_OIDC_diagram.png)

&nbsp;
## Key Differences between OAuth 2.0 and OIDC
| **Aspect**            | **OAuth 2.0**                                    | **OIDC**                                           |
|-----------------------|--------------------------------------------------|---------------------------------------------------|
| **Primary Purpose**   | Authorization (delegate access permissions)      | Authentication (identify the user)               |
| **Access Token Usage**| For accessing APIs and resources                 | For accessing APIs and resources                 |
| **ID Token**          | Not used                                         | Used for authentication (contains user claims)   |
| **Use Cases**         | API access (e.g., Google Drive, GitHub)          | User login, SSO, identity verification           |

&nbsp;
## OIDC Payload Standard Scope Parameter
- [OpenID Connect Core 1.0 Specification](https://openid.net/specs/openid-connect-core-1_0.html#IDToken)
- Main ID Token Claim
	| Claim Name      | Description                                                                 |
	|-----------------|-----------------------------------------------------------------------------|
	| `iss`           | Issuer - The URL of the Authorization Server that issued the ID Token.      |
	| `sub`           | Subject - A unique identifier for the authenticated user.                   |
	| `aud`           | Audience - The intended recipient(s) of the ID Token (typically the Client ID). |
	| `exp`           | Expiration Time - The expiration time of the ID Token, represented as a Unix timestamp. |
	| `iat`           | Issued At - The time the ID Token was issued, represented as a Unix timestamp. |
	| `auth_time`     | Authentication Time - The time when the user was last authenticated. (Optional) |
	| `nonce`         | Nonce - A value used to prevent replay attacks. Used in OAuth 2.0 Authorization Code Flow. |
	| `amr`           | Authentication Methods References - Describes the authentication methods used. |
	| `azp`           | Authorized Party - The client for which the ID Token was issued. (In the case of Authorization Code Flow) |

&nbsp;
## Direct Mobile App with OIDC
- Direct Mobile App with OIDC (No Backend)
	- In this approach, the mobile app directly interacts with the Authorization Server using the Authorization Code Flow with PKCE to obtain an Access Token and ID Token. These tokens are securely stored on the device and used for API requests and user authentication, without involving a backend server.

- Mobile App with Backend and OIDC
	- In scenarios where there is a backend, the mobile app still uses the Authorization Code Flow with PKCE to obtain an Authorization Code. However, this code is sent to the backend server, which exchanges it for the Access Token and ID Token. The backend securely stores the tokens and facilitates interactions with protected resources on behalf of the mobile app.
	
- PKCE
	- PKCE (Proof Key for Code Exchange) enhances **Authorization Code Flow** security, especially for public clients like mobile apps. It involves:
		- **code_verifier**: A random string generated by the client.
		- **code_challenge**: A hashed version sent to the server.

		This prevents interception of the authorization code by ensuring the client proves it initiated the request.

&nbsp;
## Reference
- **[OpenID Connect](https://openid.net/connect/)**
